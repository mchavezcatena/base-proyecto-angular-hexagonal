<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-container" (click)="onModalClick($event)">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="header-content">
        <h2>Asignar Roles</h2>
        <div class="user-info">
          <div class="user-avatar">
            <span>{{ user.name.charAt(0).toUpperCase() }}</span>
          </div>
          <div class="user-details">
            <h3>{{ user.name }}</h3>
            <p>{{ user.email.value }}</p>
          </div>
        </div>
      </div>
      <button class="close-button" (click)="onCancel()" type="button">
        <span>‚úï</span>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Error Message -->
      <div *ngIf="error()" class="error-message">
        <span class="error-icon">‚ö†Ô∏è</span>
        {{ error() }}
      </div>

      <!-- Roles Selection -->
      <div class="roles-section">
        <div class="section-header">
          <h4>Seleccionar Roles</h4>
          <div class="selection-info">
            <span class="selected-count">{{ selectedRolesCount() }} seleccionados</span>
            <span *ngIf="hasChanges()" class="changes-count">{{ roleChangesCount() }} cambios</span>
          </div>
        </div>

        <div *ngIf="availableRoles().length === 0" class="no-roles-message">
          <div class="no-roles-icon">üîí</div>
          <p>No hay roles disponibles para asignar</p>
        </div>

        <div *ngIf="availableRoles().length > 0" class="roles-grid">
          <div
            *ngFor="let role of availableRoles()"
            class="role-item"
            [class.selected]="isRoleSelected(role.id.value)"
            [class.currently-assigned]="isRoleCurrentlyAssigned(role.id.value)">

            <div class="role-checkbox">
              <input
                type="checkbox"
                [id]="'role-' + role.id.value"
                [checked]="isRoleSelected(role.id.value)"
                (change)="onRoleSelectionChange(role.id.value, $any($event.target).checked)">
              <label [for]="'role-' + role.id.value" class="checkbox-label"></label>
            </div>

            <div class="role-info">
              <div class="role-header">
                <h5>{{ role.name }}</h5>
                <div class="role-badges">
                  <span
                    *ngIf="isRoleCurrentlyAssigned(role.id.value)"
                    class="badge current-badge">
                    Actual
                  </span>
                  <span
                    *ngIf="role.permissions.length > 0"
                    class="badge permissions-badge">
                    {{ role.permissions.length }} permisos
                  </span>
                </div>
              </div>

              <p class="role-description">{{ role.description || 'Sin descripci√≥n' }}</p>

              <div *ngIf="role.permissions.length > 0" class="role-permissions">
                <span class="permissions-label">Permisos:</span>
                <div class="permissions-list">
                  <span
                    *ngFor="let permission of role.permissions.slice(0, 3)"
                    class="permission-tag">
                    {{ permission }}
                  </span>
                  <span
                    *ngIf="role.permissions.length > 3"
                    class="permission-tag more">
                    +{{ role.permissions.length - 3 }} m√°s
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Selection Summary -->
      <div *ngIf="selectedRolesCount() > 0" class="selection-summary">
        <h5>Resumen de Asignaci√≥n</h5>
        <div class="summary-content">
          <div class="summary-item">
            <span class="summary-label">Roles seleccionados:</span>
            <span class="summary-value">{{ selectedRolesCount() }}</span>
          </div>
          <div *ngIf="hasChanges()" class="summary-item">
            <span class="summary-label">Cambios a realizar:</span>
            <span class="summary-value">{{ roleChangesCount() }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button
        class="cancel-button"
        (click)="onCancel()"
        type="button"
        [disabled]="loading()">
        Cancelar
      </button>

      <button
        class="assign-button"
        (click)="onAssignRoles()"
        type="button"
        [disabled]="loading() || selectedRolesCount() === 0">
        <span *ngIf="loading()" class="loading-spinner"></span>
        <span *ngIf="!loading()">
          {{ hasChanges() ? 'Guardar Cambios' : 'Asignar Roles' }}
        </span>
        <span *ngIf="loading()">Asignando...</span>
      </button>
    </div>
  </div>
</div>
